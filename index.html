<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Fixed Speed Runner</title>
    <style>
        body { 
            margin: 0; overflow: hidden; background: #000; 
            font-family: 'Segoe UI', sans-serif;
            touch-action: none; user-select: none;
        }
        #ui-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; display: flex; flex-direction: column; justify-content: space-between;
        }
        #score-board {
            padding: 20px; color: #00ff88; font-size: 28px; font-weight: bold; text-shadow: 0 0 10px #00ff88;
        }
        #game-over-screen {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            text-align: center; display: none; pointer-events: auto;
            background: rgba(0, 0, 0, 0.9); padding: 30px; border: 2px solid #ff4444; border-radius: 10px;
        }
        button {
            background: #ff4444; color: #fff; border: none; padding: 10px 30px; font-size: 20px;
            cursor: pointer; margin-top: 15px; border-radius: 5px;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>
    <div id="ui-container">
        <div id="score-board">SCORE: <span id="score">0</span></div>
    </div>
    <div id="game-over-screen">
        <h1 style="color:red; margin:0;">CRASHED!</h1>
        <p style="color:white;">Score: <span id="final-score">0</span></p>
        <button onclick="restartGame()">PLAY AGAIN</button>
    </div>

    <script>
        // --- কনফিগারেশন (ফিক্সড স্পিড) ---
        const GAME_SPEED = 0.6; // এই স্পিড কখনও চেঞ্জ হবে না
        const SPAWN_RATE = 1000; // ১ সেকেন্ড পর পর বাধা আসবে

        let scene, camera, renderer, player;
        let obstacles = [];
        let score = 0;
        let isGameOver = false;
        let obstacleTimeout; // টাইমার ট্র্যাক করার জন্য

        // প্লেয়ার ভেরিয়েবল
        let currentLane = 0; 
        const laneWidth = 3;
        let isJumping = false;
        let jumpVelocity = 0;
        const gravity = 0.03;

        // টাচ ভেরিয়েবল
        let touchStartX = 0, touchStartY = 0;

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x101010);
            scene.fog = new THREE.Fog(0x101010, 20, 60);

            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 100);
            camera.position.set(0, 4, 8);
            camera.lookAt(0, 0, -8);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // আলো
            const ambient = new THREE.AmbientLight(0xffffff, 0.8);
            scene.add(ambient);
            const dirLight = new THREE.DirectionalLight(0xffffff, 0.5);
            dirLight.position.set(0, 10, 5);
            scene.add(dirLight);

            // ফ্লোর গ্রিড
            const grid = new THREE.GridHelper(200, 50, 0x00ff88, 0x222222);
            grid.position.z = -50;
            scene.add(grid);

            // প্লেয়ার
            const geometry = new THREE.BoxGeometry(1, 1, 1);
            const material = new THREE.MeshLambertMaterial({ color: 0x00ff88 });
            player = new THREE.Mesh(geometry, material);
            player.position.y = 0.5;
            scene.add(player);

            // ইনপুট লিসেনার
            document.addEventListener('keydown', handleKey);
            document.addEventListener('touchstart', e => {
                touchStartX = e.changedTouches[0].screenX;
                touchStartY = e.changedTouches[0].screenY;
            });
            document.addEventListener('touchend', handleTouch);
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });

            // গেম শুরু
            animate();
            spawnObstacleLoop();
        }

        function handleKey(e) {
            if(isGameOver) return;
            if(e.key === 'ArrowLeft' && currentLane > -1) currentLane--;
            if(e.key === 'ArrowRight' && currentLane < 1) currentLane++;
            if((e.key === 'ArrowUp' || e.code === 'Space') && !isJumping) {
                isJumping = true; jumpVelocity = 0.6;
            }
        }

        function handleTouch(e) {
            if(isGameOver) return;
            let dx = e.changedTouches[0].screenX - touchStartX;
            let dy = e.changedTouches[0].screenY - touchStartY;
            if(Math.abs(dx) > Math.abs(dy)) {
                if(dx > 30 && currentLane < 1) currentLane++;
                if(dx < -30 && currentLane > -1) currentLane--;
            } else if(dy < -30 && !isJumping) {
                isJumping = true; jumpVelocity = 0.6;
            }
        }

        function spawnObstacle() {
            if(isGameOver) return;
            const geo = new THREE.BoxGeometry(1.2, 1.2, 1.2);
            const mat = new THREE.MeshLambertMaterial({ color: 0xff0044 });
            const ob = new THREE.Mesh(geo, mat);
            ob.position.set((Math.floor(Math.random()*3)-1)*laneWidth, 0.6, -100);
            scene.add(ob);
            obstacles.push(ob);
        }

        function spawnObstacleLoop() {
            if(isGameOver) return;
            spawnObstacle();
            // টাইমার সেট করা হচ্ছে এবং ভেরিয়েবলে রাখা হচ্ছে যাতে ক্লিয়ার করা যায়
            obstacleTimeout = setTimeout(spawnObstacleLoop, SPAWN_RATE);
        }

        function animate() {
            if (isGameOver) return; // গেম ওভার হলে লুপ পুরোপুরি বন্ধ

            // ১. প্লেয়ার মুভমেন্ট
            player.position.x += (currentLane * laneWidth - player.position.x) * 0.2;

            if (isJumping) {
                player.position.y += jumpVelocity;
                jumpVelocity -= gravity;
                if (player.position.y <= 0.5) {
                    player.position.y = 0.5;
                    isJumping = false;
                }
            }

            // ২. অবস্টাকল মুভমেন্ট (ফিক্সড স্পিড)
            for (let i = obstacles.length - 1; i >= 0; i--) {
                let ob = obstacles[i];
                ob.position.z += GAME_SPEED;

                // কলিশন চেক
                if (ob.position.z > -1 && ob.position.z < 1) {
                    if (Math.abs(ob.position.x - player.position.x) < 1 && player.position.y < 1) {
                        gameOver();
                        return; // কলিশন হলে সাথে সাথে অ্যানিমেশন বন্ধ
                    }
                }

                // ক্লিনআপ
                if (ob.position.z > 5) {
                    scene.remove(ob);
                    obstacles.splice(i, 1);
                    score++;
                    document.getElementById('score').innerText = score;
                }
            }

            renderer.render(scene, camera);
            requestAnimationFrame(animate); // পরের ফ্রেম কল করা
        }

        function gameOver() {
            isGameOver = true;
            clearTimeout(obstacleTimeout); // বাধা আসার টাইমার বন্ধ
            document.getElementById('final-score').innerText = score;
            document.getElementById('game-over-screen').style.display = 'block';
        }

        function restartGame() {
            // আগের সব অবজেক্ট ক্লিন করা
            obstacles.forEach(ob => scene.remove(ob));
            obstacles = [];
            
            // ভেরিয়েবল রিসেট
            score = 0;
            currentLane = 0;
            isGameOver = false; // ফ্ল্যাগ রিসেট
            
            // UI রিসেট
            document.getElementById('score').innerText = '0';
            document.getElementById('game-over-screen').style.display = 'none';
            
            // প্লেয়ার রিসেট
            player.position.x = 0;
            player.position.y = 0.5;
            
            // নতুন করে লুপ শুরু
            animate(); 
            spawnObstacleLoop();
        }

        init();
    </script>
</body>
    </html>
